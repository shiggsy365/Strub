Index: app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.stremiompvplayer.viewmodels\n\nimport android.util.Log\nimport androidx.lifecycle.LiveData\nimport androidx.lifecycle.MediatorLiveData\nimport androidx.lifecycle.MutableLiveData\nimport androidx.lifecycle.ViewModel\nimport androidx.lifecycle.map\nimport androidx.lifecycle.viewModelScope\nimport com.example.stremiompvplayer.CatalogRepository\nimport com.example.stremiompvplayer.models.Meta\nimport com.example.stremiompvplayer.models.MetaItem\nimport com.example.stremiompvplayer.models.Stream\nimport com.example.stremiompvplayer.models.UserCatalog\nimport com.example.stremiompvplayer.network.TMDBClient\nimport com.example.stremiompvplayer.network.TraktClient\nimport com.example.stremiompvplayer.network.TraktDeviceCodeResponse\nimport com.example.stremiompvplayer.utils.Secrets\nimport com.example.stremiompvplayer.utils.SharedPreferencesManager\nimport kotlinx.coroutines.Job\nimport kotlinx.coroutines.async\nimport kotlinx.coroutines.awaitAll\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.launch\nimport com.example.stremiompvplayer.network.TraktIds\nimport com.example.stremiompvplayer.network.TraktMovie\nimport com.example.stremiompvplayer.models.CollectedItem\nimport com.example.stremiompvplayer.models.TMDBMovieListResponse\nimport com.example.stremiompvplayer.models.TMDBSeriesListResponse\nimport com.example.stremiompvplayer.models.WatchProgress\nimport com.example.stremiompvplayer.network.TraktHistoryBody\nimport com.example.stremiompvplayer.network.TraktShow\nimport com.example.stremiompvplayer.network.TraktScrobbleBody\nimport com.example.stremiompvplayer.network.TraktEpisode\nimport com.example.stremiompvplayer.models.Video\nimport com.example.stremiompvplayer.models.TMDBWatchlistBody\nimport com.example.stremiompvplayer.network.AIOStreamsClient\n\n\nclass MainViewModel(\n    private val catalogRepository: CatalogRepository,\n    private val prefsManager: SharedPreferencesManager\n) : ViewModel() {\n\n    // --- Core LiveData ---\n    private val _currentCatalogContent = MutableLiveData<List<MetaItem>>()\n    val currentCatalogContent: LiveData<List<MetaItem>> = _currentCatalogContent\n\n    private val _currentLogo = MutableLiveData<String?>()\n    val currentLogo: LiveData<String?> = _currentLogo\n    private var logoFetchJob: Job? = null\n\n    private val apiKey: String get() = prefsManager.getTMDBApiKey() ?: \"\"\n\n    // Track current catalog to allow refreshing\n    private var lastRequestedCatalog: UserCatalog? = null\n    private var loadedContentCache: MutableList<MetaItem> = mutableListOf()\n\n    // === CATALOG CONFIGURATION ===\n    // Raw source from DB\n    private val _allCatalogsRaw: LiveData<List<UserCatalog>> = catalogRepository.allCatalogs\n\n    // FILTERED Config List: Used by Settings & Discover\n    // Removes \"Next Up\" and \"Continue Watching\" so they only appear on Home\n    val allCatalogConfigs: LiveData<List<UserCatalog>> = _allCatalogsRaw.map { list ->\n        list.filter { cat ->\n            val id = cat.catalogId\n            // Exclude these IDs from the configurable list\n            id != \"next_up\" &&\n                    id != \"continue_movies\" &&\n                    id != \"continue_episodes\" &&\n                    id != \"trakt_next_up\" &&\n                    id != \"trakt_continue_movies\" &&\n                    id != \"trakt_continue_shows\"\n        }\n    }\n\n    val movieCatalogs = allCatalogConfigs.map { it.filter { c -> c.catalogType == \"movie\" && c.showInUser }.sortedBy { c -> c.displayOrder } }\n    val seriesCatalogs = allCatalogConfigs.map { it.filter { c -> c.catalogType == \"series\" && c.showInUser }.sortedBy { c -> c.displayOrder } }\n\n    // === HOME SCREEN LIVE DATA ===\n    private val _homeNextUp = MutableLiveData<List<MetaItem>>()\n    val homeNextUp: LiveData<List<MetaItem>> = _homeNextUp\n\n    private val _homeContinueEpisodes = MutableLiveData<List<MetaItem>>()\n    val homeContinueEpisodes: LiveData<List<MetaItem>> = _homeContinueEpisodes\n\n    private val _homeContinueMovies = MutableLiveData<List<MetaItem>>()\n    val homeContinueMovies: LiveData<List<MetaItem>> = _homeContinueMovies\n\n    // UI State\n    private val _streams = MutableLiveData<List<Stream>>()\n    val streams: LiveData<List<Stream>> = _streams\n    private val _metaDetails = MutableLiveData<Meta?>()\n    val metaDetails: LiveData<Meta?> = _metaDetails\n    private val _seasonEpisodes = MutableLiveData<List<MetaItem>>()\n    val seasonEpisodes: LiveData<List<MetaItem>> = _seasonEpisodes\n    private val _castList = MutableLiveData<List<MetaItem>>()\n    val castList: LiveData<List<MetaItem>> = _castList\n    private val _director = MutableLiveData<MetaItem?>()\n    val director: LiveData<MetaItem?> = _director\n    private val _error = MutableLiveData<String>()\n    val error: LiveData<String> = _error\n    private val _isLoading = MutableLiveData<Boolean>()\n    val isLoading: LiveData<Boolean> = _isLoading\n    private val _actionResult = MutableLiveData<ActionResult>()\n    val actionResult: LiveData<ActionResult> = _actionResult\n\n    // Trakt State\n    private val _traktDeviceCode = MutableLiveData<TraktDeviceCodeResponse?>()\n    val traktDeviceCode: LiveData<TraktDeviceCodeResponse?> = _traktDeviceCode\n    private val _isTraktEnabled = MutableLiveData<Boolean>(prefsManager.isTraktEnabled())\n    val isTraktEnabled: LiveData<Boolean> = _isTraktEnabled\n    private val _traktSyncProgress = MutableLiveData<String>()\n    val traktSyncProgress: LiveData<String> = _traktSyncProgress\n    private val _traktSyncStatus = MutableLiveData<TraktSyncStatus>()\n    val traktSyncStatus: LiveData<TraktSyncStatus> = _traktSyncStatus\n\n    // Library Sources (Local + Trakt)\n    val libraryMovies = MediatorLiveData<List<MetaItem>>()\n    val librarySeries = MediatorLiveData<List<MetaItem>>()\n\n    private val _localMoviesRaw = catalogRepository.getLibraryItems(prefsManager.getCurrentUserId() ?: \"default\", \"movie\").map { items ->\n        items.map { toMetaItem(it) }\n    }\n    private val _localSeriesRaw = catalogRepository.getLibraryItems(prefsManager.getCurrentUserId() ?: \"default\", \"series\").map { items ->\n        items.map { toMetaItem(it) }\n    }\n\n    private val _traktMoviesRaw = MutableLiveData<List<MetaItem>>()\n    private val _traktSeriesRaw = MutableLiveData<List<MetaItem>>()\n\n    // Filtered library for UI\n    private val _filteredLibraryMovies = MutableLiveData<List<MetaItem>>()\n    val filteredLibraryMovies: LiveData<List<MetaItem>> = _filteredLibraryMovies\n\n    private val _filteredLibrarySeries = MutableLiveData<List<MetaItem>>()\n    val filteredLibrarySeries: LiveData<List<MetaItem>> = _filteredLibrarySeries\n\n    // Library Status Checks\n    private val _isItemInWatchlist = MutableLiveData<Boolean>(false)\n    val isItemInWatchlist: LiveData<Boolean> = _isItemInWatchlist\n    private val _isItemInLibrary = MutableLiveData<Boolean>(false)\n    val isItemInLibrary: LiveData<Boolean> = _isItemInLibrary\n    private val _isItemWatched = MutableLiveData<Boolean>(false)\n    val isItemWatched: LiveData<Boolean> = _isItemWatched\n\n    // Search & Auth\n    private val _searchResults = MutableLiveData<List<MetaItem>>()\n    val searchResults: LiveData<List<MetaItem>> = _searchResults\n    private val _isSearching = MutableLiveData<Boolean>()\n    val isSearching: LiveData<Boolean> = _isSearching\n    private val _requestToken = MutableLiveData<String?>()\n    val requestToken: LiveData<String?> = _requestToken\n    private val _sessionId = MutableLiveData<String?>()\n    val sessionId: LiveData<String?> = _sessionId\n\n    init {\n        setupLibrarySources()\n        initDefaultCatalogs()\n        initUserLists()\n        if (prefsManager.isTraktEnabled()) {\n            syncTraktLibrary()\n            startPeriodicTraktSync()\n        }\n    }\n\n    // === HELPER FUNCTIONS ===\n    private fun toMetaItem(item: CollectedItem): MetaItem {\n        return MetaItem(item.itemId, item.itemType, item.name, item.poster, item.background, item.description)\n    }\n\n    // === LIBRARY SOURCE MANAGEMENT ===\n    private fun setupLibrarySources() {\n        libraryMovies.addSource(_isTraktEnabled) { updateMovieSource() }\n        libraryMovies.addSource(_localMoviesRaw) { updateMovieSource() }\n        libraryMovies.addSource(_traktMoviesRaw) { updateMovieSource() }\n\n        librarySeries.addSource(_isTraktEnabled) { updateSeriesSource() }\n        librarySeries.addSource(_localSeriesRaw) { updateSeriesSource() }\n        librarySeries.addSource(_traktSeriesRaw) { updateSeriesSource() }\n    }\n\n    private fun updateMovieSource() {\n        val localItems = _localMoviesRaw.value ?: emptyList()\n        val traktItems = if (_isTraktEnabled.value == true) _traktMoviesRaw.value ?: emptyList() else emptyList()\n        val combined = (localItems + traktItems).distinctBy { it.id }\n        libraryMovies.value = combined\n        filterAndSortLibrary(\"movie\")\n    }\n\n    private fun updateSeriesSource() {\n        val localItems = _localSeriesRaw.value ?: emptyList()\n        val traktItems = if (_isTraktEnabled.value == true) _traktSeriesRaw.value ?: emptyList() else emptyList()\n        val combined = (localItems + traktItems).distinctBy { it.id }\n        librarySeries.value = combined\n        filterAndSortLibrary(\"series\")\n    }\n\n    // === TRAKT AUTHENTICATION ===\n    fun startTraktAuth() {\n        viewModelScope.launch {\n            try {\n                val body = mapOf(\"client_id\" to Secrets.TRAKT_CLIENT_ID)\n                val codeResponse = TraktClient.api.getDeviceCode(body)\n                _traktDeviceCode.postValue(codeResponse)\n                pollTraktToken(codeResponse)\n            } catch (e: Exception) {\n                _error.postValue(\"Trakt Auth Error: ${e.message}\")\n            }\n        }\n    }\n\n    private fun pollTraktToken(codeData: TraktDeviceCodeResponse) {\n        viewModelScope.launch {\n            var attempts = 0\n            val interval = if (codeData.interval > 0) codeData.interval else 5\n            val maxAttempts = codeData.expires_in / interval\n\n            while (attempts < maxAttempts) {\n                delay(interval * 1000L)\n                try {\n                    val body = mapOf(\n                        \"code\" to codeData.device_code,\n                        \"client_id\" to Secrets.TRAKT_CLIENT_ID,\n                        \"client_secret\" to Secrets.TRAKT_CLIENT_SECRET\n                    )\n                    val token = TraktClient.api.getDeviceToken(body)\n\n                    prefsManager.saveTraktTokens(token.access_token, token.refresh_token)\n                    _isTraktEnabled.postValue(true)\n                    _traktDeviceCode.postValue(null)\n\n                    // Auto-sync on successful auth\n                    syncTraktLibrary()\n\n                    // Trigger full setup including lists\n                    performTraktSync(syncHistory = true, syncNextUp = true, syncLists = true, fetchMetadata = false)\n\n                    startPeriodicTraktSync()\n\n                    _actionResult.postValue(ActionResult.Success(\"Trakt connected successfully!\"))\n                    return@launch\n                } catch (e: Exception) {\n                    attempts++\n                }\n            }\n            _error.postValue(\"Trakt Auth Timed Out\")\n        }\n    }\n\n    fun logoutTrakt() {\n        prefsManager.clearTraktData()\n        _isTraktEnabled.postValue(false)\n        _traktMoviesRaw.postValue(emptyList())\n        _traktSeriesRaw.postValue(emptyList())\n        _actionResult.postValue(ActionResult.Success(\"Trakt disconnected\"))\n    }\n\n    // === ENHANCED TRAKT SYNC ===\n    fun syncTraktLibrary() {\n        val token = prefsManager.getTraktAccessToken() ?: return\n        val bearer = \"Bearer $token\"\n        val clientId = Secrets.TRAKT_CLIENT_ID\n\n        _isLoading.postValue(true)\n        viewModelScope.launch {\n            try {\n                // Fetch Movies\n                val movies = TraktClient.api.getMovieCollection(bearer, clientId)\n                val metaMovies = movies.mapNotNull { it.movie }.map { movie ->\n                    MetaItem(\n                        id = \"tmdb:${movie.ids.tmdb}\",\n                        type = \"movie\",\n                        name = movie.title,\n                        poster = null,\n                        background = null,\n                        description = null,\n                        releaseDate = movie.year?.toString()\n                    )\n                }\n                _traktMoviesRaw.postValue(metaMovies)\n\n                // Fetch Shows\n                val shows = TraktClient.api.getShowCollection(bearer, clientId)\n                val metaShows = shows.mapNotNull { it.show }.map { show ->\n                    MetaItem(\n                        id = \"tmdb:${show.ids.tmdb}\",\n                        type = \"series\",\n                        name = show.title,\n                        poster = null,\n                        background = null,\n                        description = null,\n                        releaseDate = show.year?.toString()\n                    )\n                }\n                _traktSeriesRaw.postValue(metaShows)\n\n            } catch (e: Exception) {\n                Log.e(\"Trakt\", \"Sync failed\", e)\n            } finally {\n                _isLoading.postValue(false)\n            }\n        }\n    }\n\n    // === CONTENT LOADING (Refactored) ===\n\n    // Original method used by DiscoverFragment\n    fun loadContentForCatalog(catalog: UserCatalog, isInitialLoad: Boolean = true) {\n        if (apiKey.isEmpty()) return\n\n        _isLoading.postValue(true)\n        if (isInitialLoad) {\n            loadedContentCache.clear()\n            lastRequestedCatalog = catalog\n        }\n\n        viewModelScope.launch {\n            try {\n                val items = fetchCatalogItems(catalog)\n\n                if (isInitialLoad) {\n                    loadedContentCache.addAll(items)\n                    _currentCatalogContent.postValue(loadedContentCache)\n                } else {\n                    _currentCatalogContent.postValue(items)\n                }\n            } catch (e: Exception) {\n                _error.postValue(\"Load failed: ${e.message}\")\n                if (isInitialLoad) {\n                    _currentCatalogContent.postValue(emptyList())\n                }\n            } finally {\n                _isLoading.postValue(false)\n            }\n        }\n    }\n\n    // Load all Home sections in parallel (Called by HomeFragment)\n    fun loadHomeContent() {\n        if (apiKey.isEmpty()) return\n\n        viewModelScope.launch {\n            val userId = prefsManager.getCurrentUserId() ?: \"default\"\n            val isTrakt = prefsManager.isTraktEnabled()\n\n            // Create catalogs on the fly for Home (skipping the filtered DB list)\n            val nextUpCat = if (isTrakt) UserCatalog(0, userId, \"trakt_next_up\", \"series\", \"Next Up\", null, 0, \"series\", \"trakt\", \"trakt_official\", true, true)\n            else UserCatalog(0, userId, \"next_up\", \"series\", \"Next Up\", null, 0, \"series\", \"local\", \"local\", true, true)\n\n            val continueShowCat = if (isTrakt) UserCatalog(0, userId, \"trakt_continue_shows\", \"series\", \"Continue Watching\", null, 0, \"series\", \"trakt\", \"trakt_official\", true, true)\n            else UserCatalog(0, userId, \"continue_episodes\", \"series\", \"Continue Watching\", null, 0, \"series\", \"local\", \"local\", true, true)\n\n            val continueMovieCat = if (isTrakt) UserCatalog(0, userId, \"trakt_continue_movies\", \"movie\", \"Continue Watching\", null, 0, \"movies\", \"trakt\", \"trakt_official\", true, true)\n            else UserCatalog(0, userId, \"continue_movies\", \"movie\", \"Continue Watching\", null, 0, \"movies\", \"local\", \"local\", true, true)\n\n            val nextUpJob = async { fetchCatalogItems(nextUpCat) }\n            val showsJob = async { fetchCatalogItems(continueShowCat) }\n            val moviesJob = async { fetchCatalogItems(continueMovieCat) }\n\n            try {\n                _homeNextUp.postValue(nextUpJob.await())\n                _homeContinueEpisodes.postValue(showsJob.await())\n                _homeContinueMovies.postValue(moviesJob.await())\n            } catch (e: Exception) {\n                Log.e(\"HomeLoad\", \"Error loading home content\", e)\n            }\n        }\n    }\n\n    // Reusable suspended function\n    private suspend fun fetchCatalogItems(catalog: UserCatalog): List<MetaItem> {\n        if (catalog.addonUrl == \"trakt\") {\n            val token = prefsManager.getTraktAccessToken()\n            val clientId = Secrets.TRAKT_CLIENT_ID\n\n            if (token != null) {\n                val bearer = \"Bearer $token\"\n                val items: List<MetaItem> = when (catalog.catalogId) {\n                    \"trakt_next_up\" -> generateNextUpList()\n\n                    \"trakt_continue_movies\" -> {\n                        val list = TraktClient.api.getPausedMovies(bearer, clientId)\n                        list.mapNotNull { it.movie }.map { movie ->\n                            MetaItem(id = \"tmdb:${movie.ids.tmdb}\", type = \"movie\", name = movie.title, description = \"Paused\", poster = null, background = null)\n                        }\n                    }\n\n                    \"trakt_continue_shows\" -> {\n                        val list = TraktClient.api.getPausedEpisodes(bearer, clientId)\n                        list.mapNotNull { item ->\n                            val show = item.show\n                            val ep = item.episode\n                            if (show != null && ep != null) {\n                                val epTmdbId = ep.ids?.tmdb\n                                if (epTmdbId != null) {\n                                    MetaItem(\n                                        id = \"trakt_ep:${show.ids.tmdb}:$epTmdbId\",\n                                        type = \"episode\",\n                                        name = \"${show.title} - ${ep.number}\",\n                                        description = \"Paused at ${(item.progress ?: 0f).toInt()}%\",\n                                        poster = null, background = null\n                                    )\n                                } else null\n                            } else null\n                        }\n                    }\n\n                    \"trakt_watchlist_movies\" -> {\n                        TraktClient.api.getWatchlist(bearer, clientId, type = \"movies\")\n                            .mapNotNull { it.movie }\n                            .map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"movie\", it.title, null, null, null) }\n                    }\n                    \"trakt_watchlist_shows\" -> {\n                        TraktClient.api.getWatchlist(bearer, clientId, type = \"shows\")\n                            .mapNotNull { it.show }\n                            .map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"series\", it.title, null, null, null) }\n                    }\n\n                    \"trakt_popular_movies\" -> TraktClient.api.getPopularMovies(clientId).map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"movie\", it.title, null, null, null) }\n                    \"trakt_popular_shows\" -> TraktClient.api.getPopularShows(clientId).map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"series\", it.title, null, null, null) }\n                    \"trakt_trending_movies\" -> TraktClient.api.getTrendingMovies(clientId).mapNotNull { it.movie }.map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"movie\", it.title, null, null, null) }\n                    \"trakt_trending_shows\" -> TraktClient.api.getTrendingShows(clientId).mapNotNull { it.show }.map { MetaItem(\"tmdb:${it.ids.tmdb}\", \"series\", it.title, null, null, null) }\n\n                    else -> emptyList()\n                }\n\n                return enrichWithTmdbMetadata(items, catalog.catalogId)\n            } else {\n                return emptyList()\n            }\n\n        } else if (catalog.catalogId in listOf(\"popular\", \"latest\", \"trending\")) {\n            val pagesToLoad = listOf(1, 2)\n            val allItems = mutableListOf<MetaItem>()\n\n            val deferredResults = pagesToLoad.map { page ->\n                viewModelScope.async {\n                    try {\n                        if (catalog.catalogType == \"movie\") {\n                            when (catalog.catalogId) {\n                                \"popular\" -> TMDBClient.api.getPopularMovies(apiKey, page = page)\n                                \"latest\" -> TMDBClient.api.getLatestMovies(apiKey, page = page)\n                                else -> TMDBClient.api.getTrendingMovies(apiKey, page = page)\n                            }\n                        } else {\n                            when (catalog.catalogId) {\n                                \"popular\" -> TMDBClient.api.getPopularSeries(apiKey, page = page)\n                                \"latest\" -> TMDBClient.api.getLatestSeries(apiKey, page = page)\n                                else -> TMDBClient.api.getTrendingSeries(apiKey, page = page)\n                            }\n                        }\n                    } catch (e: Exception) { null }\n                }\n            }\n            val results = deferredResults.awaitAll()\n            results.filterNotNull().forEach { response ->\n                val fetchedItems = if (response is TMDBMovieListResponse) {\n                    response.results.map { it.toMetaItem() }\n                } else if (response is TMDBSeriesListResponse) {\n                    response.results.map { it.toMetaItem() }\n                } else { emptyList() }\n                allItems.addAll(fetchedItems)\n            }\n            return allItems\n\n        } else {\n            return when (catalog.catalogId) {\n                \"continue_movies\" -> {\n                    val currentUserId = prefsManager.getCurrentUserId() ?: \"default\"\n                    catalogRepository.getContinueWatching(currentUserId, \"movie\").map { progress ->\n                        MetaItem(id = progress.itemId, type = progress.type, name = progress.name ?: \"Unknown\", poster = progress.poster, background = progress.background, description = null, isWatched = progress.isWatched, progress = progress.progress, duration = progress.duration)\n                    }\n                }\n                \"continue_episodes\" -> {\n                    val currentUserId = prefsManager.getCurrentUserId() ?: \"default\"\n                    catalogRepository.getContinueWatching(currentUserId, \"episode\").map { progress ->\n                        MetaItem(id = progress.itemId, type = progress.type, name = progress.name ?: \"Unknown\", poster = progress.poster, background = progress.background, description = null, isWatched = progress.isWatched, progress = progress.progress, duration = progress.duration)\n                    }\n                }\n                \"next_up\" -> generateNextUpList()\n                else -> emptyList()\n            }\n        }\n    }\n\n    private suspend fun enrichWithTmdbMetadata(items: List<MetaItem>, catalogId: String): List<MetaItem> {\n        return items.map { item ->\n            viewModelScope.async {\n                try {\n                    if (item.id.startsWith(\"trakt_ep:\")) {\n                        val parts = item.id.split(\":\")\n                        val showTmdbId = parts[1].toIntOrNull()\n\n                        if (showTmdbId != null && apiKey.isNotEmpty()) {\n                            val details = TMDBClient.api.getTVDetails(showTmdbId, apiKey)\n                            val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                            val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n\n                            val newId = \"tmdb:$showTmdbId:1:1\"\n\n                            item.copy(\n                                id = newId,\n                                poster = poster,\n                                background = background,\n                                name = \"${details.name} - ${item.name}\",\n                                description = \"${item.description}\\n\\n(Resume info limited)\"\n                            )\n                        } else item\n                    } else {\n                        val parts = item.id.removePrefix(\"tmdb:\").split(\":\")\n                        val tmdbId = parts[0].toIntOrNull()\n\n                        if (tmdbId != null && apiKey.isNotEmpty()) {\n                            if (item.type == \"movie\") {\n                                val details = TMDBClient.api.getMovieDetails(tmdbId, apiKey)\n                                val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n                                item.copy(poster = poster, background = background, description = details.overview)\n                            } else {\n                                val details = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                                val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n                                item.copy(poster = poster, background = background, description = details.overview)\n                            }\n                        } else item\n                    }\n                } catch (e: Exception) { item }\n            }\n        }.awaitAll()\n    }\n\n    // === NEXT UP GENERATION ===\n    private suspend fun generateNextUpList(): List<MetaItem> {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return emptyList()\n        val watchedEpisodes = catalogRepository.getNextUpCandidates(currentUserId)\n        val dateFormat = java.text.SimpleDateFormat(\"yyyy-MM-dd\", java.util.Locale.getDefault())\n        val today = dateFormat.format(java.util.Date())\n\n        val latestEpisodesByShow = watchedEpisodes\n            .filter { it.parentId != null && it.season != null && it.episode != null }\n            .groupBy { it.parentId!! }\n            .mapValues { (_, episodes) ->\n                episodes.maxWithOrNull(compareBy<WatchProgress> { it.season!! }.thenBy { it.episode!! })\n            }\n\n        val nextUpItems = mutableListOf<Pair<MetaItem, Long>>() // Pair of MetaItem and lastUpdated timestamp\n\n        for ((showId, latestEpisode) in latestEpisodesByShow) {\n            if (latestEpisode == null) continue\n\n            val tmdbId = showId.removePrefix(\"tmdb:\").toIntOrNull() ?: continue\n            val currentSeason = latestEpisode.season!!\n            val currentEpisode = latestEpisode.episode!!\n\n            try {\n                val showDetails = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                var nextSeasonNum = currentSeason\n                var nextEpisodeNum = currentEpisode + 1\n                var potentialNextFound = false\n\n                val currentSeasonSpec = showDetails.seasons?.find { it.season_number == currentSeason }\n                if (currentSeasonSpec != null && currentEpisode < currentSeasonSpec.episode_count) {\n                    potentialNextFound = true\n                } else {\n                    val nextSeasonSpec = showDetails.seasons?.find { it.season_number == currentSeason + 1 }\n                    if (nextSeasonSpec != null && nextSeasonSpec.episode_count > 0) {\n                        nextSeasonNum = currentSeason + 1\n                        nextEpisodeNum = 1\n                        potentialNextFound = true\n                    }\n                }\n\n                if (potentialNextFound) {\n                    try {\n                        val seasonDetails = TMDBClient.api.getTVSeasonDetails(tmdbId, nextSeasonNum, apiKey)\n                        val nextEpDetails = seasonDetails.episodes.find { it.episode_number == nextEpisodeNum }\n\n                        if (nextEpDetails != null) {\n                            val isReleased = nextEpDetails.airDate == null || nextEpDetails.airDate <= today\n\n                            if (isReleased) {\n                                val nextEpisodeId = \"$showId:$nextSeasonNum:$nextEpisodeNum\"\n                                val nextEpisodeProgress = catalogRepository.getWatchProgress(currentUserId, nextEpisodeId)\n\n                                if (nextEpisodeProgress == null || !nextEpisodeProgress.isWatched) {\n                                    val poster = nextEpDetails.still_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                        ?: showDetails.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n\n                                    val background = nextEpDetails.still_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n                                        ?: showDetails.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n\n                                    val metaItem = MetaItem(\n                                        id = nextEpisodeId,\n                                        type = \"episode\",\n                                        name = nextEpDetails.name,\n                                        poster = poster,\n                                        background = background,\n                                        description = nextEpDetails.overview ?: \"Next episode\"\n                                    )\n                                    nextUpItems.add(Pair(metaItem, latestEpisode.lastUpdated))\n                                }\n                            }\n                        }\n                    } catch (e: Exception) { Log.e(\"NextUp\", \"Failed season details\", e) }\n                }\n            } catch (e: Exception) { Log.e(\"NextUp\", \"Error processing next episode\", e) }\n        }\n        // Sort by lastUpdated (most recent first) and return only the MetaItems\n        return nextUpItems.sortedByDescending { it.second }.map { it.first }\n    }\n\n    // === TRAKT SYNC ===\n    fun performTraktSync(syncHistory: Boolean, syncNextUp: Boolean, syncLists: Boolean, fetchMetadata: Boolean = true) {\n        if (!prefsManager.isTraktEnabled()) return\n\n        _traktSyncStatus.postValue(TraktSyncStatus.Syncing(\"Syncing...\"))\n        viewModelScope.launch {\n            val userId = prefsManager.getCurrentUserId() ?: \"default\"\n            val token = prefsManager.getTraktAccessToken() ?: return@launch\n            val bearer = \"Bearer $token\"\n            val clientId = Secrets.TRAKT_CLIENT_ID\n\n            try {\n                if (syncHistory) {\n                    _traktSyncStatus.postValue(TraktSyncStatus.Syncing(\"Fetching watched history...\"))\n\n                    val watchedMovies = TraktClient.api.getWatchedMovies(bearer, clientId)\n                    val importedMovieIds = mutableListOf<Int>()\n\n                    watchedMovies.forEach { item ->\n                        item.movie?.ids?.tmdb?.let { tmdbId ->\n                            val meta = MetaItem(\"tmdb:$tmdbId\", \"movie\", item.movie.title, null, null, \"Trakt Import\")\n                            catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, meta))\n                            catalogRepository.saveWatchProgress(WatchProgress(userId, meta.id, \"movie\", 0, 0, true, System.currentTimeMillis(), meta.name, null, null, null, null, null))\n                            importedMovieIds.add(tmdbId)\n                        }\n                    }\n\n                    val watchedShows = TraktClient.api.getWatchedShows(bearer, clientId)\n                    val importedShowIds = mutableListOf<Int>()\n\n                    watchedShows.forEach { item ->\n                        item.show?.ids?.tmdb?.let { showTmdbId ->\n                            val seriesMeta = MetaItem(\"tmdb:$showTmdbId\", \"series\", item.show.title, null, null, \"Trakt Import\")\n                            catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, seriesMeta))\n                            importedShowIds.add(showTmdbId)\n\n                            item.seasons?.forEach { season ->\n                                season.episodes.forEach { ep ->\n                                    val epId = \"tmdb:$showTmdbId:${season.number}:${ep.number}\"\n                                    catalogRepository.saveWatchProgress(\n                                        WatchProgress(userId, epId, \"episode\", 0, 0, true, System.currentTimeMillis(),\n                                            \"${item.show.title} S${season.number}E${ep.number}\", null, null, \"tmdb:$showTmdbId\", season.number, ep.number)\n                                    )\n                                }\n                            }\n                        }\n                    }\n\n                    // Refresh TMDB metadata for all imported items\n                    if (fetchMetadata && apiKey.isNotEmpty()) {\n                        _traktSyncStatus.postValue(TraktSyncStatus.Syncing(\"Refreshing metadata from TMDB...\"))\n\n                        // Refresh movie metadata\n                        importedMovieIds.forEach { tmdbId ->\n                            try {\n                                val details = TMDBClient.api.getMovieDetails(tmdbId, apiKey)\n                                val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n\n                                // Update the library item with enriched metadata\n                                val enrichedMeta = MetaItem(\n                                    id = \"tmdb:$tmdbId\",\n                                    type = \"movie\",\n                                    name = details.title,\n                                    poster = poster,\n                                    background = background,\n                                    description = details.overview,\n                                    releaseDate = details.release_date\n                                )\n                                catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, enrichedMeta))\n                            } catch (e: Exception) {\n                                Log.e(\"TraktSync\", \"Failed to refresh movie $tmdbId: ${e.message}\")\n                            }\n                        }\n\n                        // Refresh show metadata\n                        importedShowIds.forEach { tmdbId ->\n                            try {\n                                val details = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                                val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n\n                                // Update the library item with enriched metadata\n                                val enrichedMeta = MetaItem(\n                                    id = \"tmdb:$tmdbId\",\n                                    type = \"series\",\n                                    name = details.name,\n                                    poster = poster,\n                                    background = background,\n                                    description = details.overview,\n                                    releaseDate = null\n                                )\n                                catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, enrichedMeta))\n                            } catch (e: Exception) {\n                                Log.e(\"TraktSync\", \"Failed to refresh show $tmdbId: ${e.message}\")\n                            }\n                        }\n                    }\n                }\n\n                // No need to insert \"Next Up\" or \"Continue Watching\" to DB anymore\n                // They are handled dynamically by HomeFragment.\n                // We only sync lists like Watchlists/Popular to DB for Discover page.\n\n                if (syncLists) {\n                    val catalogs = listOf(\n                        UserCatalog(0, userId, \"trakt_watchlist_movies\", \"movie\", \"Trakt Watchlist\", null, 1, \"movies\", \"trakt\", \"trakt_official\", true, false),\n                        UserCatalog(0, userId, \"trakt_watchlist_shows\", \"series\", \"Trakt Watchlist\", null, 1, \"series\", \"trakt\", \"trakt_official\", true, false),\n                        UserCatalog(0, userId, \"trakt_trending_movies\", \"movie\", \"Trakt Trending\", null, 3, \"movies\", \"trakt\", \"trakt_official\", true, true),\n                        UserCatalog(0, userId, \"trakt_trending_shows\", \"series\", \"Trakt Trending\", null, 3, \"series\", \"trakt\", \"trakt_official\", true, true)\n                    )\n\n                    catalogs.forEach {\n                        if (!catalogRepository.isCatalogAdded(userId, it.catalogId, it.catalogType, it.pageType)) {\n                            catalogRepository.insertCatalog(it)\n                        }\n                    }\n                }\n\n                // After sync, ensure all library items have metadata\n                if (fetchMetadata && apiKey.isNotEmpty()) {\n                    _traktSyncStatus.postValue(TraktSyncStatus.Syncing(\"Checking library for missing metadata...\"))\n                    ensureAllLibraryItemsHaveMetadata()\n                }\n\n                _traktSyncStatus.postValue(TraktSyncStatus.Success(\"Sync Complete\"))\n\n            } catch (e: Exception) {\n                _traktSyncStatus.postValue(TraktSyncStatus.Error(e.message ?: \"Error\"))\n            } finally {\n                _isLoading.postValue(false)\n            }\n        }\n    }\n\n    private suspend fun ensureAllLibraryItemsHaveMetadata() {\n        val userId = prefsManager.getCurrentUserId() ?: return\n        if (apiKey.isEmpty()) return\n\n        withContext(Dispatchers.IO) {\n            try {\n                // Get all library items\n                val libraryItems = catalogRepository.getAllLibraryItems(userId)\n\n                libraryItems.forEach { item ->\n                    // Check if item is missing metadata (no poster or background)\n                    if (item.poster.isNullOrEmpty() || item.background.isNullOrEmpty()) {\n                        val tmdbId = item.itemId.removePrefix(\"tmdb:\").split(\":\").firstOrNull()?.toIntOrNull()\n                        if (tmdbId != null) {\n                            try {\n                                when (item.itemType) {\n                                    \"movie\" -> {\n                                        val details = TMDBClient.api.getMovieDetails(tmdbId, apiKey)\n                                        val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                        val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n                                        val enrichedMeta = MetaItem(\n                                            id = \"tmdb:$tmdbId\",\n                                            type = \"movie\",\n                                            name = details.title,\n                                            poster = poster,\n                                            background = background,\n                                            description = details.overview,\n                                            releaseDate = details.release_date\n                                        )\n                                        catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, enrichedMeta))\n                                    }\n                                    \"series\" -> {\n                                        val details = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                                        val poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }\n                                        val background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" }\n                                        val enrichedMeta = MetaItem(\n                                            id = \"tmdb:$tmdbId\",\n                                            type = \"series\",\n                                            name = details.name,\n                                            poster = poster,\n                                            background = background,\n                                            description = details.overview,\n                                            releaseDate = null\n                                        )\n                                        catalogRepository.addToLibrary(CollectedItem.fromMetaItem(userId, enrichedMeta))\n                                    }\n                                }\n                            } catch (e: Exception) {\n                                Log.e(\"MetadataSync\", \"Failed to fetch metadata for ${item.itemId}: ${e.message}\")\n                            }\n                        }\n                    }\n                }\n            } catch (e: Exception) {\n                Log.e(\"MetadataSync\", \"Error ensuring library metadata: ${e.message}\")\n            }\n        }\n    }\n\n    private fun startPeriodicTraktSync() {\n        viewModelScope.launch {\n            while (prefsManager.isTraktEnabled()) {\n                delay(30 * 60 * 1000L) // Every 30 minutes\n                syncTraktLibrary()\n            }\n        }\n    }\n\n    // === WATCHED ACTION & REFRESH ===\n    fun markAsWatched(item: MetaItem, syncToTrakt: Boolean = true) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        val idStr = item.id.removePrefix(\"tmdb:\")\n        val tmdbId = idStr.toIntOrNull()\n\n        viewModelScope.launch {\n            try {\n                if (syncToTrakt && prefsManager.isTraktEnabled()) {\n                    val token = prefsManager.getTraktAccessToken()\n                    if (token != null) {\n                        val bearer = \"Bearer $token\"\n                        val body = if (item.type == \"movie\") {\n                            val id = item.id.removePrefix(\"tmdb:\").toIntOrNull()\n                            if (id != null) TraktHistoryBody(movies = listOf(TraktMovie(\"\", null, TraktIds(0, id, null, null)))) else null\n                        } else if (item.type == \"episode\") {\n                            val parts = item.id.split(\":\")\n                            if (parts.size >= 4) {\n                                val e = parts[3].toIntOrNull()\n                                if (e != null) TraktHistoryBody(episodes = listOf(TraktEpisode(e, 1, null, null))) else null\n                            } else null\n                        } else null\n\n                        if (body != null) {\n                            TraktClient.api.addToHistory(bearer, Secrets.TRAKT_CLIENT_ID, body)\n                        }\n                    }\n                }\n\n                if (item.type == \"series\" && tmdbId != null && apiKey.isNotEmpty()) {\n                    val details = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                    details.seasons?.forEach { season ->\n                        if (season.episode_count > 0) {\n                            val seasonDetails = TMDBClient.api.getTVSeasonDetails(tmdbId, season.season_number, apiKey)\n                            seasonDetails.episodes.forEach { ep ->\n                                val epId = \"tmdb:$tmdbId:${ep.season_number}:${ep.episode_number}\"\n                                catalogRepository.saveWatchProgress(WatchProgress(currentUserId, epId, \"episode\", 0, 0, true, System.currentTimeMillis(), \"${details.name} S${season.season_number}E${ep.episode_number}\", null, null, \"tmdb:$tmdbId\", season.season_number, ep.episode_number))\n                            }\n                        }\n                    }\n                } else if (item.type == \"episode\") {\n                    val parts = item.id.split(\":\")\n                    if (parts.size >= 4) {\n                        val parentId = \"${parts[0]}:${parts[1]}\"\n                        val s = parts[2].toIntOrNull()\n                        val e = parts[3].toIntOrNull()\n                        catalogRepository.saveWatchProgress(WatchProgress(currentUserId, item.id, \"episode\", 0, 0, true, System.currentTimeMillis(), item.name, item.poster, item.background, parentId, s, e))\n                    }\n                } else {\n                    catalogRepository.saveWatchProgress(WatchProgress(currentUserId, item.id, item.type, 0, 0, true, System.currentTimeMillis(), item.name, item.poster, item.background, null, null, null))\n                }\n\n                // Refresh\n                lastRequestedCatalog?.let {\n                    loadContentForCatalog(it, isInitialLoad = false)\n                }\n                // Also reload home if needed\n                loadHomeContent()\n\n                _isItemWatched.postValue(true)\n                _actionResult.postValue(ActionResult.Success(\"Marked as watched\"))\n\n            } catch (e: Exception) {\n                _actionResult.postValue(ActionResult.Error(\"Failed: ${e.message}\"))\n            }\n        }\n    }\n\n    fun clearWatchedStatus(item: MetaItem, syncToTrakt: Boolean = true) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        val tmdbId = item.id.removePrefix(\"tmdb:\").split(\":\")[0].toIntOrNull()\n\n        viewModelScope.launch {\n            try {\n                if (syncToTrakt && prefsManager.isTraktEnabled() && tmdbId != null) {\n                    val token = prefsManager.getTraktAccessToken()\n                    if (token != null) {\n                        val bearer = \"Bearer $token\"\n                        val body = if (item.type == \"movie\") {\n                            TraktHistoryBody(movies = listOf(TraktMovie(\"\", null, TraktIds(0, tmdbId, null, null))))\n                        } else null\n\n                        if (body != null) TraktClient.api.removeFromHistory(bearer, Secrets.TRAKT_CLIENT_ID, body)\n                    }\n                }\n\n                catalogRepository.updateWatchedStatus(currentUserId, item.id, false)\n                lastRequestedCatalog?.let { loadContentForCatalog(it, isInitialLoad = false) }\n                loadHomeContent()\n\n                _isItemWatched.postValue(false)\n                _actionResult.postValue(ActionResult.Success(\"Cleared watched status\"))\n            } catch (e: Exception) {\n                _actionResult.postValue(ActionResult.Error(\"Failed: ${e.message}\"))\n            }\n        }\n    }\n\n    // === STANDARD METHODS ===\n    fun loadStreams(type: String, itemId: String) {\n        _isLoading.postValue(true)\n        viewModelScope.launch {\n            val allStreams = mutableListOf<Stream>()\n            val aioUsername = prefsManager.getAIOStreamsUsername()\n            val aioPassword = prefsManager.getAIOStreamsPassword()\n            val aioUrl = prefsManager.getAIOStreamsUrl() ?: \"https://aiostreams.shiggsy.co.uk\"\n\n            if (!aioUsername.isNullOrEmpty() && !aioPassword.isNullOrEmpty()) {\n                try {\n                    val aioApi = AIOStreamsClient.getApi(aioUrl, aioUsername, aioPassword)\n                    val aioResponse = aioApi.searchStreams(type, itemId)\n                    if (aioResponse.success && aioResponse.data != null) {\n                        allStreams.addAll(aioResponse.data.results)\n                    }\n                } catch (e: Exception) { Log.e(\"MainViewModel\", \"AIOStreams error\", e) }\n            }\n            _streams.postValue(allStreams)\n            _isLoading.postValue(false)\n        }\n    }\n\n    fun loadEpisodeStreams(seriesId: String, season: Int, episode: Int) {\n        val episodeId = \"$seriesId:$season:$episode\"\n        loadStreams(\"series\", episodeId)\n    }\n\n    fun loadSeriesMeta(itemId: String) {\n        if (apiKey.isEmpty()) return\n        viewModelScope.launch {\n            try {\n                val tmdbId = itemId.removePrefix(\"tmdb:\").toIntOrNull() ?: return@launch\n                val details = TMDBClient.api.getTVDetails(tmdbId, apiKey)\n                val meta = Meta(\n                    id = itemId,\n                    type = \"series\",\n                    name = details.name,\n                    poster = details.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" },\n                    background = details.backdrop_path?.let { \"https://image.tmdb.org/t/p/original$it\" },\n                    description = details.overview,\n                    videos = details.seasons?.map { season ->\n                        Video(season.id.toString(), season.name, null, season.poster_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }, null, season.season_number)\n                    }\n                )\n                _metaDetails.postValue(meta)\n            } catch (e: Exception) { _error.postValue(\"Failed to load series details: ${e.message}\") }\n        }\n    }\n\n    fun loadSeasonEpisodes(seriesId: String, seasonNumber: Int) {\n        if (apiKey.isEmpty()) return\n        viewModelScope.launch {\n            try {\n                val tmdbId = seriesId.removePrefix(\"tmdb:\").toIntOrNull() ?: return@launch\n                val seasonDetails = TMDBClient.api.getTVSeasonDetails(tmdbId, seasonNumber, apiKey)\n                val episodes = seasonDetails.episodes.map { episode ->\n                    MetaItem(\n                        id = \"tmdb:$tmdbId:${episode.season_number}:${episode.episode_number}\",\n                        type = \"episode\",\n                        name = episode.name,\n                        poster = episode.still_path?.let { \"https://image.tmdb.org/t/p/w500$it\" },\n                        background = null,\n                        description = episode.overview\n                    )\n                }\n                _seasonEpisodes.postValue(episodes)\n            } catch (e: Exception) { _error.postValue(\"Failed to load season episodes: ${e.message}\") }\n        }\n    }\n\n    fun fetchCast(itemId: String, type: String) {\n        if (apiKey.isEmpty()) return\n        viewModelScope.launch {\n            try {\n                val tmdbId = itemId.removePrefix(\"tmdb:\").toIntOrNull() ?: return@launch\n                val credits = if (type == \"movie\") TMDBClient.api.getMovieCredits(tmdbId, apiKey) else TMDBClient.api.getTVCredits(tmdbId, apiKey)\n                val cast = credits.cast.take(10).map { member ->\n                    MetaItem(\"tmdb:${member.id}\", \"person\", member.name, member.profile_path?.let { \"https://image.tmdb.org/t/p/w500$it\" }, null, member.character)\n                }\n                val director = credits.crew.find { it.job == \"Director\" }?.let { member ->\n                    MetaItem(\"tmdb:${member.id}\", \"person\", member.name, null, null, \"Director\")\n                }\n                _castList.postValue(cast)\n                _director.postValue(director)\n            } catch (e: Exception) { Log.e(\"MainViewModel\", \"Failed to fetch cast\", e) }\n        }\n    }\n\n    fun checkWatchedStatus(itemId: String) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            val progress = catalogRepository.getWatchProgress(currentUserId, itemId)\n            _isItemWatched.postValue(progress?.isWatched ?: false)\n        }\n    }\n\n    fun saveWatchProgress(meta: MetaItem, currentPos: Long, duration: Long) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            val parts = meta.id.split(\":\")\n            val parentId = if (parts.size >= 3) \"${parts[0]}:${parts[1]}\" else null\n            val season = if (parts.size >= 3) parts[2].toIntOrNull() else null\n            val episode = if (parts.size >= 4) parts[3].toIntOrNull() else null\n\n            val progress = WatchProgress(\n                userId = currentUserId,\n                itemId = meta.id,\n                type = meta.type,\n                progress = currentPos,\n                duration = duration,\n                isWatched = currentPos >= duration * 0.9,\n                lastUpdated = System.currentTimeMillis(),\n                name = meta.name,\n                poster = meta.poster,\n                background = meta.background,\n                parentId = parentId,\n                season = season,\n                episode = episode\n            )\n            catalogRepository.saveWatchProgress(progress)\n        }\n    }\n\n    fun searchTMDB(query: String) {\n        if (apiKey.isEmpty() || query.isBlank()) return\n        _isSearching.postValue(true)\n        viewModelScope.launch {\n            try {\n                val response = TMDBClient.api.searchMulti(apiKey, query)\n                val results = response.results.filter { it.media_type == \"movie\" || it.media_type == \"tv\" }.map { it.toMetaItem() }\n                _searchResults.postValue(results)\n            } catch (e: Exception) {\n                _error.postValue(\"Search failed: ${e.message}\")\n                _searchResults.postValue(emptyList())\n            } finally { _isSearching.postValue(false) }\n        }\n    }\n\n    fun searchMovies(query: String) {\n        if (apiKey.isEmpty() || query.isBlank()) return\n        _isSearching.postValue(true)\n        viewModelScope.launch {\n            try {\n                val response = TMDBClient.api.searchMovies(apiKey, query)\n                val results = response.results.map { it.toMetaItem() }\n                _searchResults.postValue(results)\n            } catch (e: Exception) {\n                _error.postValue(\"Movie search failed: ${e.message}\")\n                _searchResults.postValue(emptyList())\n            } finally { _isSearching.postValue(false) }\n        }\n    }\n\n    fun searchSeries(query: String) {\n        if (apiKey.isEmpty() || query.isBlank()) return\n        _isSearching.postValue(true)\n        viewModelScope.launch {\n            try {\n                val response = TMDBClient.api.searchSeries(apiKey, query)\n                val results = response.results.map { it.toMetaItem() }\n                _searchResults.postValue(results)\n            } catch (e: Exception) {\n                _error.postValue(\"Series search failed: ${e.message}\")\n                _searchResults.postValue(emptyList())\n            } finally { _isSearching.postValue(false) }\n        }\n    }\n\n    fun loadPersonCredits(personId: Int) {\n        if (apiKey.isEmpty()) return\n        _isSearching.postValue(true)\n        viewModelScope.launch {\n            try {\n                val response = TMDBClient.api.getPersonCombinedCredits(personId, apiKey)\n                val results = response.cast.map { it.toMetaItem() }\n                _searchResults.postValue(results)\n            } catch (e: Exception) {\n                _error.postValue(\"Person credits failed: ${e.message}\")\n                _searchResults.postValue(emptyList())\n            } finally { _isSearching.postValue(false) }\n        }\n    }\n\n    fun clearSearchResults() { _searchResults.postValue(emptyList()) }\n\n    fun toggleWatchlist(meta: MetaItem, force: Boolean = false) {\n        if (apiKey.isEmpty()) return\n        val sessionId = prefsManager.getTMDBSessionId()\n        val accountId = prefsManager.getTMDBAccountId()\n        if (sessionId.isNullOrEmpty() || accountId == -1) return\n\n        viewModelScope.launch {\n            try {\n                val tmdbId = meta.id.removePrefix(\"tmdb:\").toIntOrNull() ?: return@launch\n                val mediaType = if (meta.type == \"series\") \"tv\" else \"movie\"\n                val isCurrentlyInWatchlist = _isItemInWatchlist.value ?: false\n                val body = TMDBWatchlistBody(mediaType, tmdbId, if (force) true else !isCurrentlyInWatchlist)\n                TMDBClient.api.addToWatchlist(accountId, apiKey, sessionId, body)\n                _isItemInWatchlist.postValue(if (force) true else !isCurrentlyInWatchlist)\n                _actionResult.postValue(ActionResult.Success(\"Watchlist updated\"))\n            } catch (e: Exception) { _actionResult.postValue(ActionResult.Error(\"Watchlist operation failed: ${e.message}\")) }\n        }\n    }\n\n    fun checkLibraryStatus(itemId: String) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            val isCollected = catalogRepository.isItemCollected(itemId, currentUserId)\n            _isItemInLibrary.postValue(isCollected)\n        }\n    }\n\n    fun checkWatchlistStatus(itemId: String, type: String) { _isItemInWatchlist.postValue(false) }\n\n    fun fetchRequestToken() {\n        if (apiKey.isEmpty()) return\n        viewModelScope.launch {\n            try {\n                val response = TMDBClient.api.createRequestToken(apiKey)\n                if (response.success) _requestToken.postValue(response.requestToken)\n                else _error.postValue(\"Failed to create TMDB request token\")\n            } catch (e: Exception) { _error.postValue(\"TMDB Auth error: ${e.message}\") }\n        }\n    }\n\n    fun createSession(requestToken: String) {\n        if (apiKey.isEmpty()) return\n        viewModelScope.launch {\n            try {\n                val body = mapOf(\"request_token\" to requestToken)\n                val response = TMDBClient.api.createSession(apiKey, body)\n                if (response.success) {\n                    prefsManager.saveTMDBSessionId(response.sessionId)\n                    _sessionId.postValue(response.sessionId)\n                    val account = TMDBClient.api.getAccountDetails(apiKey, response.sessionId)\n                    prefsManager.saveTMDBAccountId(account.id)\n                    _actionResult.postValue(ActionResult.Success(\"TMDB connected successfully\"))\n                } else { _error.postValue(\"Failed to create TMDB session\") }\n            } catch (e: Exception) { _error.postValue(\"TMDB Session error: ${e.message}\") }\n        }\n    }\n\n    fun checkTMDBAuthAndSync() {\n        val sessionId = prefsManager.getTMDBSessionId()\n        if (!sessionId.isNullOrEmpty() && apiKey.isNotEmpty()) _sessionId.postValue(sessionId)\n    }\n\n    fun initUserLists() {\n        viewModelScope.launch { catalogRepository.ensureUserListCatalogs(prefsManager.getCurrentUserId() ?: \"default\") }\n    }\n\n    fun initDefaultCatalogs() {\n        viewModelScope.launch { catalogRepository.initializeDefaultsIfNeeded() }\n    }\n\n    fun updateCatalogConfig(catalog: UserCatalog) {\n        viewModelScope.launch { catalogRepository.updateCatalog(catalog) }\n    }\n\n    fun swapCatalogOrder(catalog1: UserCatalog, catalog2: UserCatalog) {\n        viewModelScope.launch { catalogRepository.swapOrder(catalog1, catalog2) }\n    }\n\n    fun getDiscoverCatalogs(type: String): LiveData<List<UserCatalog>> {\n        // The 'allCatalogConfigs' source is already filtered to exclude Home items\n        // So we just need to check the type and 'showInDiscover'\n        return allCatalogConfigs.map { list ->\n            list.filter { cat ->\n                cat.catalogType == type && cat.showInDiscover\n            }.sortedBy { it.displayOrder }\n        }\n    }\n\n    fun filterAndSortLibrary(type: String, genre: String? = null, sortBy: String = \"dateAdded\", ascending: Boolean = false) {\n        viewModelScope.launch {\n            val rawItems = if (type == \"movie\") libraryMovies.value else librarySeries.value\n            if (rawItems == null) return@launch\n            val filtered = rawItems\n            val sorted = when (sortBy) {\n                \"dateAdded\" -> if (ascending) filtered else filtered.reversed()\n                \"releaseDate\" -> if (ascending) filtered.sortedBy { it.releaseDate ?: \"\" } else filtered.sortedByDescending { it.releaseDate ?: \"\" }\n                \"title\" -> if (ascending) filtered.sortedBy { it.name } else filtered.sortedByDescending { it.name }\n                else -> filtered\n            }\n            if (type == \"movie\") _filteredLibraryMovies.postValue(sorted) else _filteredLibrarySeries.postValue(sorted)\n        }\n    }\n\n    fun addToLibrary(meta: MetaItem, syncToTrakt: Boolean = true) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            try {\n                val item = CollectedItem.fromMetaItem(currentUserId, meta)\n                catalogRepository.addToLibrary(item)\n                _isItemInLibrary.postValue(true)\n                if (syncToTrakt && prefsManager.isTraktEnabled()) {\n                    // Sync logic omitted\n                }\n                _actionResult.postValue(ActionResult.Success(\"Added to library\"))\n            } catch (e: Exception) { _actionResult.postValue(ActionResult.Error(\"Failed to add to library: ${e.message}\")) }\n        }\n    }\n\n    fun removeFromLibrary(itemId: String, syncToTrakt: Boolean = true) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            try {\n                catalogRepository.removeFromLibrary(itemId, currentUserId)\n                _isItemInLibrary.postValue(false)\n                _actionResult.postValue(ActionResult.Success(\"Removed from library\"))\n            } catch (e: Exception) { _actionResult.postValue(ActionResult.Error(\"Failed to remove from library: ${e.message}\")) }\n        }\n    }\n\n    fun toggleLibrary(meta: MetaItem) {\n        val currentUserId = prefsManager.getCurrentUserId() ?: return\n        viewModelScope.launch {\n            if (catalogRepository.isItemCollected(meta.id, currentUserId)) removeFromLibrary(meta.id) else addToLibrary(meta)\n        }\n    }\n\n    fun scrobble(action: String, meta: MetaItem, progress: Float) {\n        if (!prefsManager.isTraktEnabled()) return\n        val token = prefsManager.getTraktAccessToken() ?: return\n        val clientId = Secrets.TRAKT_CLIENT_ID\n        viewModelScope.launch {\n            try {\n                val idStr = meta.id.removePrefix(\"tmdb:\")\n                val tmdbId = if (meta.type == \"movie\" || meta.type == \"series\") idStr.toIntOrNull() else 0\n                val body: TraktScrobbleBody? = if (meta.type == \"movie\" && tmdbId != null) {\n                    TraktScrobbleBody(progress, TraktMovie(meta.name, null, TraktIds(0, tmdbId, null, null)))\n                } else if (meta.type == \"episode\") {\n                    val parts = meta.id.split(\":\")\n                    if (parts.size >= 4) {\n                        val showId = parts[1].toIntOrNull()\n                        val s = parts[2].toIntOrNull()\n                        val e = parts[3].toIntOrNull()\n                        if (showId != null && s != null && e != null) {\n                            TraktScrobbleBody(progress, episode = TraktEpisode(s, e), show = TraktShow(meta.name, null, TraktIds(0, showId, null, null)))\n                        } else null\n                    } else null\n                } else null\n\n                if (body != null) {\n                    val bearer = \"Bearer $token\"\n                    when (action) {\n                        \"start\" -> TraktClient.api.startScrobble(bearer, clientId, body = body)\n                        \"pause\" -> TraktClient.api.pauseScrobble(bearer, clientId, body = body)\n                        \"stop\" -> TraktClient.api.stopScrobble(bearer, clientId, body = body)\n                    }\n                }\n            } catch (e: Exception) { Log.e(\"Trakt\", \"Scrobble failed\", e) }\n        }\n    }\n\n    fun fetchItemLogo(meta: MetaItem) {\n        logoFetchJob?.cancel()\n        _currentLogo.value = \"\"\n        logoFetchJob = viewModelScope.launch {\n            try {\n                val idParts = meta.id.removePrefix(\"tmdb:\").split(\":\")\n                val tmdbId = idParts[0].toIntOrNull()\n                if (tmdbId != null && apiKey.isNotEmpty()) {\n                    val images = if (meta.type == \"movie\") TMDBClient.api.getMovieImages(tmdbId, apiKey) else TMDBClient.api.getTVImages(tmdbId, apiKey)\n                    val logo = images.logos.firstOrNull()\n                    _currentLogo.postValue(logo?.let { \"https://image.tmdb.org/t/p/w300${it.file_path}\" })\n                } else { _currentLogo.postValue(null) }\n            } catch (e: Exception) { _currentLogo.postValue(null) }\n        }\n    }\n\n    sealed class TraktSyncStatus {\n        object Idle : TraktSyncStatus()\n        data class Syncing(val progress: String) : TraktSyncStatus()\n        data class Success(val message: String) : TraktSyncStatus()\n        data class Error(val message: String) : TraktSyncStatus()\n    }\n\n    sealed class ActionResult {\n        data class Success(val message: String) : ActionResult()\n        data class Error(val message: String) : ActionResult()\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt b/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt
--- a/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt	(revision 563e097b783a436c18229c5cb3344970c02a056d)
+++ b/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt	(date 1763938436692)
@@ -35,6 +35,8 @@
 import com.example.stremiompvplayer.models.Video
 import com.example.stremiompvplayer.models.TMDBWatchlistBody
 import com.example.stremiompvplayer.network.AIOStreamsClient
+import kotlinx.coroutines.Dispatchers
+import kotlinx.coroutines.withContext
 
 
 class MainViewModel(
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AndroidLayouts\">\n    <shared>\n      <config />\n    </shared>\n    <layouts>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/color/focus_indicator_selector.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/avatar_background.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/background_content_box.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/badge_background.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/button_background.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/default_background.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/gradient_overlay.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/gradient_overlay_modern.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_arrow_back_white_24dp.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_arrow_drop_down.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_arrow_up.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_check_circle.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_discover.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_exit_to_app.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_person.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_search_off.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_star.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/ic_tv.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/modern_button_background.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/modern_focus_selector.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/modern_gradient_overlay.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/modern_rating_badge.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/poster_gradient_overlay.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/drawable/selector_focus_border.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/activity_details2.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/activity_main.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/activity_player.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/activity_settings.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/activity_user_selection.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/dialog_tmdb_auth.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_discover.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_library.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_library_new.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_movies.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_search.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_search_new.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/fragment_series.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_catalog_config.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_catalog_config_settings.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_discover_catalog.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_discover_sidebar.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_poster.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_stream.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_user_list.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/layout/item_user_profile.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer</theme>\n        </config>\n      </layout>\n      <layout url=\"file://$PROJECT_DIR$/app/src/main/res/xml/network_security_config.xml\">\n        <config>\n          <theme>@style/Theme.StremioMPVPlayer.Leanback</theme>\n        </config>\n      </layout>\n    </layouts>\n  </component>\n  <component name=\"AutoImportSettings\">\n    <option name=\"autoReloadType\" value=\"NONE\" />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"2c02766e-19a3-4317-ae82-959ae60a24cb\" name=\"Changes\" comment=\"Update visual assets\">\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/models/UserCatalogDao.kt\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/models/UserCatalogDao.kt\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TMDBApiService.kt\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TMDBApiService.kt\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TraktClient.kt\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TraktClient.kt\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/ui/discover/DiscoverFragment.kt\" beforeDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt\" afterDir=\"false\" />\n    </list>\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"ClangdSettings\">\n    <option name=\"formatViaClangd\" value=\"false\" />\n  </component>\n  <component name=\"ExecutionTargetManager\" SELECTED_TARGET=\"device_and_snapshot_combo_box_target[DeviceId(pluginId=Default, isTemplate=false, identifier=serial=192.168.1.247:5555;connection=6fc0cebc)]\" />\n  <component name=\"ExternalProjectsData\">\n    <projectState path=\"$PROJECT_DIR$\">\n      <ProjectState />\n    </projectState>\n  </component>\n  <component name=\"ExternalProjectsManager\">\n    <system id=\"GRADLE\">\n      <state>\n        <projects_view>\n          <tree_state>\n            <expand>\n              <path>\n                <item name=\"\" type=\"6a2764b6:ExternalProjectsStructure$RootNode\" />\n                <item name=\"StremioMPVPlayer\" type=\"f1a62948:ProjectNode\" />\n              </path>\n            </expand>\n            <select />\n          </tree_state>\n        </projects_view>\n      </state>\n    </system>\n  </component>\n  <component name=\"FileTemplateManagerImpl\">\n    <option name=\"RECENT_TEMPLATES\">\n      <list>\n        <option value=\"Kotlin Data Class\" />\n        <option value=\"Class\" />\n        <option value=\"Kotlin File\" />\n        <option value=\"resourceFile\" />\n        <option value=\"valueResourceFile\" />\n        <option value=\"layoutResourceFile\" />\n        <option value=\"Kotlin Class\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"GenerateSignedApkSettings\">\n    <option name=\"BUILD_TARGET_KEY\" value=\"apk\" />\n  </component>\n  <component name=\"Git.Settings\">\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\n  </component>\n  <component name=\"GitHubPullRequestSearchHistory\">{\n  &quot;lastFilter&quot;: {\n    &quot;state&quot;: &quot;OPEN&quot;,\n    &quot;assignee&quot;: &quot;shiggsy365-maker&quot;\n  }\n}</component>\n  <component name=\"GithubPullRequestsUISettings\">{\n  &quot;selectedUrlAndAccountId&quot;: {\n    &quot;url&quot;: &quot;https://github.com/shiggsy365/Strub.git&quot;,\n    &quot;accountId&quot;: &quot;4bb637b3-d6d5-4661-b5ed-e0473b167b56&quot;\n  }\n}</component>\n  <component name=\"ProblemsViewState\">\n    <option name=\"selectedTabId\" value=\"CurrentFile\" />\n    <option name=\"showPreview\" value=\"true\" />\n  </component>\n  <component name=\"ProjectColorInfo\">{\n  &quot;associatedIndex&quot;: 0\n}</component>\n  <component name=\"ProjectId\" id=\"35bEU0DGeQmI8RsswKzeu8HRMFt\" />\n  <component name=\"ProjectLevelVcsManager\">\n    <ConfirmationsSetting value=\"1\" id=\"Add\" />\n  </component>\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </component>\n  <component name=\"PropertiesComponent\">{\n  &quot;keyToString&quot;: {\n    &quot;Android App.app.executor&quot;: &quot;Run&quot;,\n    &quot;ApkExportedModule&quot;: &quot;StremioMPVPlayer.app&quot;,\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.cidr.known.project.marker&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.readMode.enableVisualFormatting&quot;: &quot;true&quot;,\n    &quot;SHARE_PROJECT_CONFIGURATION_FILES&quot;: &quot;true&quot;,\n    &quot;cf.first.check.clang-format&quot;: &quot;false&quot;,\n    &quot;cidr.known.project.marker&quot;: &quot;true&quot;,\n    &quot;com.google.services.firebase.aqiPopupShown&quot;: &quot;true&quot;,\n    &quot;git-widget-placeholder&quot;: &quot;master&quot;,\n    &quot;last_opened_file_path&quot;: &quot;/home/jon/AndroidStudioProjects/Slingshot/app/src/main/res/values&quot;,\n    &quot;project.structure.last.edited&quot;: &quot;Variables&quot;,\n    &quot;project.structure.proportion&quot;: &quot;0.17&quot;,\n    &quot;project.structure.side.proportion&quot;: &quot;0.0&quot;,\n    &quot;recommended.upgrade.last.time.stamp&quot;: &quot;1763425586759&quot;,\n    &quot;settings.editor.selected.configurable&quot;: &quot;memory.settings&quot;\n  }\n}</component>\n  <component name=\"RecentsManager\">\n    <key name=\"android.template.326038633\">\n      <recent name=\"com.example.stremiompvplayer\" />\n    </key>\n    <key name=\"CopyFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/values\" />\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/drawable\" />\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/layout\" />\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/animator\" />\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/color\" />\n    </key>\n    <key name=\"MoveFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/drawable\" />\n      <recent name=\"$PROJECT_DIR$/app/src/main/res/color\" />\n    </key>\n    <key name=\"K2MoveDeclarationsDialog.RECENT_PACKAGE_KEY\">\n      <recent name=\"xyz.mpv.is.xyz.mpv\" />\n      <recent name=\"com.example.stremiompvplayer.network\" />\n      <recent name=\"com.example.stremiompvplayer.models\" />\n      <recent name=\"com.example.stremiompvplayer.data\" />\n      <recent name=\"com.example.stremiompvplayer.viewmodels\" />\n    </key>\n  </component>\n  <component name=\"RunManager\">\n    <configuration name=\"app\" type=\"AndroidRunConfigurationType\" factoryName=\"Android App\" activateToolWindowBeforeRun=\"false\">\n      <module name=\"BINGE.app\" />\n      <option name=\"ANDROID_RUN_CONFIGURATION_SCHEMA_VERSION\" value=\"1\" />\n      <option name=\"DEPLOY\" value=\"true\" />\n      <option name=\"DEPLOY_APK_FROM_BUNDLE\" value=\"false\" />\n      <option name=\"DEPLOY_AS_INSTANT\" value=\"false\" />\n      <option name=\"ARTIFACT_NAME\" value=\"\" />\n      <option name=\"PM_INSTALL_OPTIONS\" value=\"\" />\n      <option name=\"ALL_USERS\" value=\"false\" />\n      <option name=\"ALWAYS_INSTALL_WITH_PM\" value=\"false\" />\n      <option name=\"ALLOW_ASSUME_VERIFIED\" value=\"false\" />\n      <option name=\"CLEAR_APP_STORAGE\" value=\"false\" />\n      <option name=\"DYNAMIC_FEATURES_DISABLED_LIST\" value=\"\" />\n      <option name=\"ACTIVITY_EXTRA_FLAGS\" value=\"\" />\n      <option name=\"MODE\" value=\"default_activity\" />\n      <option name=\"RESTORE_ENABLED\" value=\"false\" />\n      <option name=\"RESTORE_FILE\" value=\"\" />\n      <option name=\"RESTORE_FRESH_INSTALL_ONLY\" value=\"false\" />\n      <option name=\"CLEAR_LOGCAT\" value=\"false\" />\n      <option name=\"SHOW_LOGCAT_AUTOMATICALLY\" value=\"false\" />\n      <option name=\"TARGET_SELECTION_MODE\" value=\"DEVICE_AND_SNAPSHOT_COMBO_BOX\" />\n      <option name=\"SELECTED_CLOUD_MATRIX_CONFIGURATION_ID\" value=\"-1\" />\n      <option name=\"SELECTED_CLOUD_MATRIX_PROJECT_ID\" value=\"\" />\n      <option name=\"DEBUGGER_TYPE\" value=\"Auto\" />\n      <Auto>\n        <option name=\"USE_JAVA_AWARE_DEBUGGER\" value=\"false\" />\n        <option name=\"SHOW_STATIC_VARS\" value=\"true\" />\n        <option name=\"WORKING_DIR\" value=\"\" />\n        <option name=\"TARGET_LOGGING_CHANNELS\" value=\"lldb process:gdb-remote packets\" />\n        <option name=\"SHOW_OPTIMIZED_WARNING\" value=\"true\" />\n        <option name=\"ATTACH_ON_WAIT_FOR_DEBUGGER\" value=\"false\" />\n        <option name=\"DEBUG_SANDBOX_SDK\" value=\"false\" />\n      </Auto>\n      <Hybrid>\n        <option name=\"USE_JAVA_AWARE_DEBUGGER\" value=\"false\" />\n        <option name=\"SHOW_STATIC_VARS\" value=\"true\" />\n        <option name=\"WORKING_DIR\" value=\"\" />\n        <option name=\"TARGET_LOGGING_CHANNELS\" value=\"lldb process:gdb-remote packets\" />\n        <option name=\"SHOW_OPTIMIZED_WARNING\" value=\"true\" />\n        <option name=\"ATTACH_ON_WAIT_FOR_DEBUGGER\" value=\"false\" />\n        <option name=\"DEBUG_SANDBOX_SDK\" value=\"false\" />\n      </Hybrid>\n      <Java>\n        <option name=\"ATTACH_ON_WAIT_FOR_DEBUGGER\" value=\"false\" />\n        <option name=\"DEBUG_SANDBOX_SDK\" value=\"false\" />\n      </Java>\n      <Native>\n        <option name=\"USE_JAVA_AWARE_DEBUGGER\" value=\"false\" />\n        <option name=\"SHOW_STATIC_VARS\" value=\"true\" />\n        <option name=\"WORKING_DIR\" value=\"\" />\n        <option name=\"TARGET_LOGGING_CHANNELS\" value=\"lldb process:gdb-remote packets\" />\n        <option name=\"SHOW_OPTIMIZED_WARNING\" value=\"true\" />\n        <option name=\"ATTACH_ON_WAIT_FOR_DEBUGGER\" value=\"false\" />\n        <option name=\"DEBUG_SANDBOX_SDK\" value=\"false\" />\n      </Native>\n      <Profilers>\n        <option name=\"ADVANCED_PROFILING_ENABLED\" value=\"false\" />\n        <option name=\"STARTUP_PROFILING_ENABLED\" value=\"false\" />\n        <option name=\"STARTUP_CPU_PROFILING_ENABLED\" value=\"false\" />\n        <option name=\"STARTUP_CPU_PROFILING_CONFIGURATION_NAME\" value=\"Java/Kotlin Method Sample (legacy)\" />\n        <option name=\"STARTUP_NATIVE_MEMORY_PROFILING_ENABLED\" value=\"false\" />\n        <option name=\"NATIVE_MEMORY_SAMPLE_RATE_BYTES\" value=\"2048\" />\n      </Profilers>\n      <option name=\"DEEP_LINK\" value=\"\" />\n      <option name=\"ACTIVITY\" value=\"\" />\n      <option name=\"ACTIVITY_CLASS\" value=\"\" />\n      <option name=\"SEARCH_ACTIVITY_IN_GLOBAL_SCOPE\" value=\"false\" />\n      <option name=\"SKIP_ACTIVITY_VALIDATION\" value=\"false\" />\n      <method v=\"2\">\n        <option name=\"Android.Gradle.BeforeRunTask\" enabled=\"true\" />\n      </method>\n    </configuration>\n  </component>\n  <component name=\"TaskManager\">\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\n      <changelist id=\"2c02766e-19a3-4317-ae82-959ae60a24cb\" name=\"Changes\" comment=\"\" />\n      <created>1763370382391</created>\n      <option name=\"number\" value=\"Default\" />\n      <option name=\"presentableId\" value=\"Default\" />\n      <updated>1763370382391</updated>\n    </task>\n    <task id=\"LOCAL-00032\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763487469223</created>\n      <option name=\"number\" value=\"00032\" />\n      <option name=\"presentableId\" value=\"LOCAL-00032\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763487469223</updated>\n    </task>\n    <task id=\"LOCAL-00033\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763487473669</created>\n      <option name=\"number\" value=\"00033\" />\n      <option name=\"presentableId\" value=\"LOCAL-00033\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763487473669</updated>\n    </task>\n    <task id=\"LOCAL-00034\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763487477697</created>\n      <option name=\"number\" value=\"00034\" />\n      <option name=\"presentableId\" value=\"LOCAL-00034\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763487477697</updated>\n    </task>\n    <task id=\"LOCAL-00035\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763505575487</created>\n      <option name=\"number\" value=\"00035\" />\n      <option name=\"presentableId\" value=\"LOCAL-00035\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763505575487</updated>\n    </task>\n    <task id=\"LOCAL-00036\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763505580271</created>\n      <option name=\"number\" value=\"00036\" />\n      <option name=\"presentableId\" value=\"LOCAL-00036\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763505580271</updated>\n    </task>\n    <task id=\"LOCAL-00037\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763509962730</created>\n      <option name=\"number\" value=\"00037\" />\n      <option name=\"presentableId\" value=\"LOCAL-00037\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763509962730</updated>\n    </task>\n    <task id=\"LOCAL-00038\" summary=\"stremio addon implementation\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763509967987</created>\n      <option name=\"number\" value=\"00038\" />\n      <option name=\"presentableId\" value=\"LOCAL-00038\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763509967987</updated>\n    </task>\n    <task id=\"LOCAL-00039\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763516519379</created>\n      <option name=\"number\" value=\"00039\" />\n      <option name=\"presentableId\" value=\"LOCAL-00039\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763516519379</updated>\n    </task>\n    <task id=\"LOCAL-00040\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763516529233</created>\n      <option name=\"number\" value=\"00040\" />\n      <option name=\"presentableId\" value=\"LOCAL-00040\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763516529233</updated>\n    </task>\n    <task id=\"LOCAL-00041\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763579382410</created>\n      <option name=\"number\" value=\"00041\" />\n      <option name=\"presentableId\" value=\"LOCAL-00041\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763579382410</updated>\n    </task>\n    <task id=\"LOCAL-00042\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763582771262</created>\n      <option name=\"number\" value=\"00042\" />\n      <option name=\"presentableId\" value=\"LOCAL-00042\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763582771262</updated>\n    </task>\n    <task id=\"LOCAL-00043\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763590590176</created>\n      <option name=\"number\" value=\"00043\" />\n      <option name=\"presentableId\" value=\"LOCAL-00043\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763590590176</updated>\n    </task>\n    <task id=\"LOCAL-00044\" summary=\"Visual layout for movies page\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763590604434</created>\n      <option name=\"number\" value=\"00044\" />\n      <option name=\"presentableId\" value=\"LOCAL-00044\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763590604434</updated>\n    </task>\n    <task id=\"LOCAL-00045\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763595922620</created>\n      <option name=\"number\" value=\"00045\" />\n      <option name=\"presentableId\" value=\"LOCAL-00045\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763595922620</updated>\n    </task>\n    <task id=\"LOCAL-00046\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763595971951</created>\n      <option name=\"number\" value=\"00046\" />\n      <option name=\"presentableId\" value=\"LOCAL-00046\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763595971951</updated>\n    </task>\n    <task id=\"LOCAL-00047\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763598212987</created>\n      <option name=\"number\" value=\"00047\" />\n      <option name=\"presentableId\" value=\"LOCAL-00047\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763598212987</updated>\n    </task>\n    <task id=\"LOCAL-00048\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763598221577</created>\n      <option name=\"number\" value=\"00048\" />\n      <option name=\"presentableId\" value=\"LOCAL-00048\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763598221577</updated>\n    </task>\n    <task id=\"LOCAL-00049\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763605788880</created>\n      <option name=\"number\" value=\"00049\" />\n      <option name=\"presentableId\" value=\"LOCAL-00049\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763605788880</updated>\n    </task>\n    <task id=\"LOCAL-00050\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763643379483</created>\n      <option name=\"number\" value=\"00050\" />\n      <option name=\"presentableId\" value=\"LOCAL-00050\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763643379483</updated>\n    </task>\n    <task id=\"LOCAL-00051\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763643383811</created>\n      <option name=\"number\" value=\"00051\" />\n      <option name=\"presentableId\" value=\"LOCAL-00051\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763643383811</updated>\n    </task>\n    <task id=\"LOCAL-00052\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763655904325</created>\n      <option name=\"number\" value=\"00052\" />\n      <option name=\"presentableId\" value=\"LOCAL-00052\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763655904325</updated>\n    </task>\n    <task id=\"LOCAL-00053\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763655908225</created>\n      <option name=\"number\" value=\"00053\" />\n      <option name=\"presentableId\" value=\"LOCAL-00053\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763655908225</updated>\n    </task>\n    <task id=\"LOCAL-00054\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763669116147</created>\n      <option name=\"number\" value=\"00054\" />\n      <option name=\"presentableId\" value=\"LOCAL-00054\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763669116148</updated>\n    </task>\n    <task id=\"LOCAL-00055\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763679361942</created>\n      <option name=\"number\" value=\"00055\" />\n      <option name=\"presentableId\" value=\"LOCAL-00055\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763679361942</updated>\n    </task>\n    <task id=\"LOCAL-00056\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763679373264</created>\n      <option name=\"number\" value=\"00056\" />\n      <option name=\"presentableId\" value=\"LOCAL-00056\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763679373264</updated>\n    </task>\n    <task id=\"LOCAL-00057\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763679827037</created>\n      <option name=\"number\" value=\"00057\" />\n      <option name=\"presentableId\" value=\"LOCAL-00057\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763679827037</updated>\n    </task>\n    <task id=\"LOCAL-00058\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763682505573</created>\n      <option name=\"number\" value=\"00058\" />\n      <option name=\"presentableId\" value=\"LOCAL-00058\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763682505573</updated>\n    </task>\n    <task id=\"LOCAL-00059\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763686235292</created>\n      <option name=\"number\" value=\"00059\" />\n      <option name=\"presentableId\" value=\"LOCAL-00059\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763686235292</updated>\n    </task>\n    <task id=\"LOCAL-00060\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763686243806</created>\n      <option name=\"number\" value=\"00060\" />\n      <option name=\"presentableId\" value=\"LOCAL-00060\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763686243806</updated>\n    </task>\n    <task id=\"LOCAL-00061\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763691342932</created>\n      <option name=\"number\" value=\"00061\" />\n      <option name=\"presentableId\" value=\"LOCAL-00061\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763691342933</updated>\n    </task>\n    <task id=\"LOCAL-00062\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763758475334</created>\n      <option name=\"number\" value=\"00062\" />\n      <option name=\"presentableId\" value=\"LOCAL-00062\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763758475334</updated>\n    </task>\n    <task id=\"LOCAL-00063\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763758496450</created>\n      <option name=\"number\" value=\"00063\" />\n      <option name=\"presentableId\" value=\"LOCAL-00063\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763758496450</updated>\n    </task>\n    <task id=\"LOCAL-00064\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763772979008</created>\n      <option name=\"number\" value=\"00064\" />\n      <option name=\"presentableId\" value=\"LOCAL-00064\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763772979008</updated>\n    </task>\n    <task id=\"LOCAL-00065\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763780792504</created>\n      <option name=\"number\" value=\"00065\" />\n      <option name=\"presentableId\" value=\"LOCAL-00065\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763780792504</updated>\n    </task>\n    <task id=\"LOCAL-00066\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763781680385</created>\n      <option name=\"number\" value=\"00066\" />\n      <option name=\"presentableId\" value=\"LOCAL-00066\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763781680385</updated>\n    </task>\n    <task id=\"LOCAL-00067\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763781687735</created>\n      <option name=\"number\" value=\"00067\" />\n      <option name=\"presentableId\" value=\"LOCAL-00067\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763781687735</updated>\n    </task>\n    <task id=\"LOCAL-00068\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763841397996</created>\n      <option name=\"number\" value=\"00068\" />\n      <option name=\"presentableId\" value=\"LOCAL-00068\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763841397997</updated>\n    </task>\n    <task id=\"LOCAL-00069\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763841402897</created>\n      <option name=\"number\" value=\"00069\" />\n      <option name=\"presentableId\" value=\"LOCAL-00069\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763841402897</updated>\n    </task>\n    <task id=\"LOCAL-00070\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763843391998</created>\n      <option name=\"number\" value=\"00070\" />\n      <option name=\"presentableId\" value=\"LOCAL-00070\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763843391998</updated>\n    </task>\n    <task id=\"LOCAL-00071\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763843395344</created>\n      <option name=\"number\" value=\"00071\" />\n      <option name=\"presentableId\" value=\"LOCAL-00071\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763843395344</updated>\n    </task>\n    <task id=\"LOCAL-00072\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763855755799</created>\n      <option name=\"number\" value=\"00072\" />\n      <option name=\"presentableId\" value=\"LOCAL-00072\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763855755799</updated>\n    </task>\n    <task id=\"LOCAL-00073\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763855759947</created>\n      <option name=\"number\" value=\"00073\" />\n      <option name=\"presentableId\" value=\"LOCAL-00073\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763855759947</updated>\n    </task>\n    <task id=\"LOCAL-00074\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763858879211</created>\n      <option name=\"number\" value=\"00074\" />\n      <option name=\"presentableId\" value=\"LOCAL-00074\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763858879211</updated>\n    </task>\n    <task id=\"LOCAL-00075\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763858883537</created>\n      <option name=\"number\" value=\"00075\" />\n      <option name=\"presentableId\" value=\"LOCAL-00075\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763858883537</updated>\n    </task>\n    <task id=\"LOCAL-00076\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763860063035</created>\n      <option name=\"number\" value=\"00076\" />\n      <option name=\"presentableId\" value=\"LOCAL-00076\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763860063036</updated>\n    </task>\n    <task id=\"LOCAL-00077\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763861917655</created>\n      <option name=\"number\" value=\"00077\" />\n      <option name=\"presentableId\" value=\"LOCAL-00077\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763861917655</updated>\n    </task>\n    <task id=\"LOCAL-00078\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763914215899</created>\n      <option name=\"number\" value=\"00078\" />\n      <option name=\"presentableId\" value=\"LOCAL-00078\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763914215899</updated>\n    </task>\n    <task id=\"LOCAL-00079\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763914363460</created>\n      <option name=\"number\" value=\"00079\" />\n      <option name=\"presentableId\" value=\"LOCAL-00079\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763914363460</updated>\n    </task>\n    <task id=\"LOCAL-00080\" summary=\"Update visual assets\">\n      <option name=\"closed\" value=\"true\" />\n      <created>1763917831928</created>\n      <option name=\"number\" value=\"00080\" />\n      <option name=\"presentableId\" value=\"LOCAL-00080\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1763917831928</updated>\n    </task>\n    <option name=\"localTasksCounter\" value=\"81\" />\n    <servers />\n  </component>\n  <component name=\"VcsManagerConfiguration\">\n    <ignored-roots>\n      <path value=\"$PROJECT_DIR$/mpv-android\" />\n    </ignored-roots>\n    <MESSAGE value=\"error fixes\" />\n    <MESSAGE value=\"stremio addon implementation\" />\n    <MESSAGE value=\"Visual layout for movies page\" />\n    <MESSAGE value=\"Update visual assets\" />\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Update visual assets\" />\n    <option name=\"GROUP_MULTIFILE_MERGE_BY_DIRECTORY\" value=\"true\" />\n  </component>\n  <component name=\"play_dynamic_filters_status\">\n    <option name=\"appIdToCheckInfo\">\n      <map>\n        <entry key=\"com.example.stremiompvplayer\">\n          <value>\n            <CheckInfo lastCheckTimestamp=\"1763841400053\" />\n          </value>\n        </entry>\n        <entry key=\"com.example.stremiompvplayer.test\">\n          <value>\n            <CheckInfo lastCheckTimestamp=\"1763841400056\" />\n          </value>\n        </entry>\n      </map>\n    </option>\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 563e097b783a436c18229c5cb3344970c02a056d)
+++ b/.idea/workspace.xml	(date 1763939275034)
@@ -253,10 +253,6 @@
   <component name="ChangeListManager">
     <list default="true" id="2c02766e-19a3-4317-ae82-959ae60a24cb" name="Changes" comment="Update visual assets">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/models/UserCatalogDao.kt" beforeDir="false" afterPath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/models/UserCatalogDao.kt" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TMDBApiService.kt" beforeDir="false" afterPath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TMDBApiService.kt" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TraktClient.kt" beforeDir="false" afterPath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/network/TraktClient.kt" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/ui/discover/DiscoverFragment.kt" beforeDir="false" />
       <change beforePath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt" beforeDir="false" afterPath="$PROJECT_DIR$/app/src/main/java/com/example/stremiompvplayer/viewmodels/MainViewModel.kt" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
@@ -463,22 +459,6 @@
       <option name="number" value="Default" />
       <option name="presentableId" value="Default" />
       <updated>1763370382391</updated>
-    </task>
-    <task id="LOCAL-00032" summary="stremio addon implementation">
-      <option name="closed" value="true" />
-      <created>1763487469223</created>
-      <option name="number" value="00032" />
-      <option name="presentableId" value="LOCAL-00032" />
-      <option name="project" value="LOCAL" />
-      <updated>1763487469223</updated>
-    </task>
-    <task id="LOCAL-00033" summary="stremio addon implementation">
-      <option name="closed" value="true" />
-      <created>1763487473669</created>
-      <option name="number" value="00033" />
-      <option name="presentableId" value="LOCAL-00033" />
-      <option name="project" value="LOCAL" />
-      <updated>1763487473669</updated>
     </task>
     <task id="LOCAL-00034" summary="stremio addon implementation">
       <option name="closed" value="true" />
@@ -856,7 +836,23 @@
       <option name="project" value="LOCAL" />
       <updated>1763917831928</updated>
     </task>
-    <option name="localTasksCounter" value="81" />
+    <task id="LOCAL-00081" summary="Update visual assets">
+      <option name="closed" value="true" />
+      <created>1763936367713</created>
+      <option name="number" value="00081" />
+      <option name="presentableId" value="LOCAL-00081" />
+      <option name="project" value="LOCAL" />
+      <updated>1763936367714</updated>
+    </task>
+    <task id="LOCAL-00082" summary="Update visual assets">
+      <option name="closed" value="true" />
+      <created>1763936388182</created>
+      <option name="number" value="00082" />
+      <option name="presentableId" value="LOCAL-00082" />
+      <option name="project" value="LOCAL" />
+      <updated>1763936388182</updated>
+    </task>
+    <option name="localTasksCounter" value="83" />
     <servers />
   </component>
   <component name="VcsManagerConfiguration">
